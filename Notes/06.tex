\chapter{Product measure}
\section{Introduction}

Given two (or finitely many) measure space $(X_1, \SM_1, \mu_1),(X_2, \SM_2, \mu_2)$
$X = X_1 \times X_2$, On $X$ there is a natural $\sigma$-algebra $\SM = \SM_1 \otimes \SM_2 =:$ $\sigma$-algebra generated by set of the form.
$E_1 \times E_2, E_1 \in \SM_1, E_2 \in \SM_2$ and 
$\mu(E_1 \times E_2) = \mu_1(E_1) \mu_2(E_2)$


Extend the set function $\mu$, defined on the general rectangles to all of $\SM_1 \otimes \SM_2$.

\begin{claim}
  The rectangles form a semiring (use cartesian product $\SM_1 \times \SM_2$ of semirings are semiring)
\end{claim}

\begin{theorem}
  Given $(X_1, \SM_1, \mu_1), (X_2, \SM_2, \mu_2)$, $\sigma$-finite measure spaces, there exists a unique measure $\mu$ on $\SM_1 \otimes \SM_2$ such that $\mu(E_1 \times E_2) = \mu_1(E_1) \mu_2(E_2)$ for all $E_1 \in \SM_1, E_2 \in \SM_2$
\end{theorem}

\begin{proof}
  $\SSS_{\text{rect}} = $ semiring of rectangles.
  Neet to show that $\nu: \SSS_{\text{rect}} \to [0, \infty)$ is a premeasure
  verify $\sigma$-additivity on $\SSS_{\text{rect}}$ If 
  $$E_1 \times E_2 = \biguplus_{j=1}^\infty E_{j, 1} \times E_{j, 2}$$then
  $$\nu(E_1 \times E_2) = \sum_{j=1}^\infty \nu(E_{j, 1} \times E_{j, 2})$$
  \[\mathbbm{1}_{E_1 \times E_2}(x_1, x_2) = \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1} \times E_{j, 2}}(x_1, x_2)\iff \mathbbm{1}_{E_1}(x_1) \mathbbm{1}_{E_2}(x_2) = \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2)\]
  \begin{align*}
    \mathbbm{1}_{E_1}(x_1) \mathbbm{1}_{E_2}(x_2) &= \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2) \\
    \int \mathbbm{1}_{E_1}(x_1) \mathbbm{1}_{E_2}(x_2)\ \mathrm{d}\mu_2 &= \int \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2) \ \mathrm{d}\mu_2\\
    \mathbbm{1}_{E_1}(x_1)\mu_2(E_2) &= \sum_{j=1}^\infty\int \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2) \ \mathrm{d}\mu_2\\
    &= \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mu_2(E_{j, 2}) \\
    \int \mathbbm{1}_{E_1}(x_1)\mu_2(E_2) \ \mathrm{d}\mu_1 &= \int \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mu_2(E_{j, 2}) \ \mathrm{d}\mu_1\\
    \mu_1(E_1)\mu_2(E_2) &= \sum_{j=1}^\infty \mu_1(E_{j, 1})\mu_2(E_{j, 2}) \\
    \nu(E_1 \times E_2) &= \sum_{j=1}^\infty \nu(E_{j, 1} \times E_{j, 2})
  \end{align*}
  % \[\mathbbm{1}_{E_1}(x_1) \mu_2(E_2) = \int \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2)\ \mathrm{d}\mu_2\ = \sum_{j}\mathbbm{1}_{E_{j, 1}}(x_1)\mu_2(E_{j, 2})\]
  % By Monotone Convergence Theorem then Integrate in $x_1$
  % \[ \nu(E_1 \times E_2) = \mu_1(E_1)\mu_2(E_2) = \int\sum_j \mathbbm{1}_{E_{j, 1}}\mu_2(E_{j, 2}) \ \mathrm{d}\mu_1 = \sum_j \mu_1(E_{j, 1})\mu_2(E_{j, 2}) = \sum_j \nu(E_{j, 1}\times E_{j, 2})\]
\end{proof}

\begin{lemma}
  If $\mu_1$ is $\sigma$-finite and $\mu_2$ is $\sigma$-finite, then $\nu$ is $\sigma$-finite.
\end{lemma}
\begin{proof}
  $X_1 = \biguplus_{j=1}^\infty X_{1, j}$, $X_2 = \biguplus_{k=1}^\infty X_{2, k}$, $\mu_1(X_{1, j}) < \infty$, $\mu_2(X_{2, k}) < \infty$
  $X_1 \times X_2 = \biguplus_{j, k} X_{1, j} \times X_{2, k}$, $\nu(X_{1, j} \times X_{2, k}) = \mu_1(X_{1, j})\mu_2(X_{2, k}) < \infty$
\end{proof}

\begin{remark}
  In Summary, we have proved that the product pre-measure extends uniquely to $\SM_1 \otimes \SM_2$. (under the assumption of $\sigma$-finiteness of $\mu_1, \mu_2$)
\end{remark}

\begin{remark}
  Constructed a product measure on $\SM_1 \otimes \SM_2$ by $\mu(E_1 \times E_2) = \mu_1(E_1)\mu_2(E_2)$
  (this is unique if $\SM_1, \SM_2$ are $\sigma$-finite)
\end{remark}

\begin{proposition}
  Let $E \in \SM_1 \otimes \SM_2$, Define  
  \[sl_{x_1}(E) = \{x_2: (x_1, x_2) \in E\}\]
  \[sl^{x_2}(E) = \{x_1 : (x_1, x_2) \in E\}\]
  Then $sl_{x_1}(E) \in \SM_2$, $sl^{x_2}(E) \in \SM_1$
\end{proposition}

\begin{proof}
  Considering the rectangle case, this is ``easy''
  \[sl_{x_1}(E_1 \times E_2) = \{x_2 : (x_1, x_2) \in E_1 \times E_2\} = \begin{cases}
    \emptyset, & x_1 \notin E_1\\
    E_2, & x_1 \in E_1
  \end{cases}\]
  Define
  \[\mathcal{C}_{x_1} = \{E \subseteq f(X_1 \times X_2) : sl_{x_1}(E) \in \SM_2\}\]
  konw $\mathcal{C}_{x_1}$ contains $\SSS_{\text{rect}}$ 

  Check $\mathcal{C}_{x_1}$ is a $\sigma$-algebra (If so, $\mathcal{C}_{x_1}$ contains $\kM(\SSS_{\text{rect}}) = \SM_1 \otimes \SM_2$)

  Let $E \in \mathcal{C}_{x_1}$, consider $E^\complement = X \setminus E$  
  \[sl_{x_1}(E^\complement) = \{x_2 : (x_1, x_2) \not\in E\} = \{x_2 : x_2 \not\in sl_{x_1}(E)\} = (sl_{x_1}(E))^\complement = X_2 \setminus sl_{x_1}(E)\]
  % and is a $\sigma$-algebra. 
\end{proof}

\begin{lemma}
  Let $f$ be a $(\SM_1 \otimes \SM_2)$-measurable. Then $f_{x_1}(x_2) = f(x_1, x_2)$ is an $\SM_2$-measurable,
  and $f^{x_2}(x_1) = f(x_1, x_2)$ is an $\SM_1$-measurable
\end{lemma}

\begin{proof}
  Check: $f^{-1}_{x_1}(I) \in \SM_2$, for any Borel set $I$
  \begin{align*}
    f^{-1}_{x_1}(I) &= \{x_2 : f_{x_1}(x_2) = f(x_1, x_2) \in I\} \\
    &= sl_{x_1}\{(x_1, x_2) : f(x_1, x_2) \in I\} \\
    &= sl_{x_1}(\underbrace{f^{-1}(I)}_{\in \SM_1 \otimes \SM_2})
  \end{align*}
\end{proof}

\section{Cavalieri's Principle}

\begin{theorem}
  Let $(X_1, \SM_1, \mu_1), (X_2, \SM_2, \mu_2)$ be $\sigma$-finite and let $\mu$  be a product measure of two measure space.
  For any $E \in \SM_1 \otimes \SM_2$, then
  \begin{enumerate}[(i)]
    \item $g_E : x_1 \mapsto \mu_2(sl_{x_1}(E))$ is $\SM_1$-measurable
    \item $h_E : x_2 \mapsto \mu_1(sl_{x_2}(E))$ is $\SM_2$-measurable
  \end{enumerate}
  and 
  \begin{enumerate}[(i)]
    \item $\mu(E) = \int \mu_2(sl_{x_1}(E)) \ \mathrm{d}\mu_1$
    \item $\mu(E) = \int \mu_1(sl_{x_2}(E)) \ \mathrm{d}\mu_2$
  \end{enumerate}
\end{theorem}

\begin{proof}
  Using standard trick $\varphi \subseteq \kP(X_1 \times X_2)$ for which part (i) of the theorem is true
  check $\varphi$ is a $\sigma$-algebra and it contains the $\SSS_{\text{rect}}$

  Cor of claim: $\varphi$ contains $\kM(\SSS_{\text{rect}}) \overset{\text{def}}{=} \SM_1 \otimes \SM_2$

  Consider $E \in \SSS_{\text{rect}}$, i.e., $E = E_1 \times E_2$, $E_1 \in \SM_1, E_2 \in \SM_2$
  then \[sl_{x_1}(E) = \begin{cases}
    E_2  & \text{if } x_1 \in E_1 \\
    \emptyset & \text{if } x_1 \notin E_1
  \end{cases}\]
  \[g_E(x_1) = \mu_2(sl_{x_1}(E)) = \mathbbm{1}_{E_1}(x_1) \mu_2(E_2)\]
  \[\int g_E \ \mathrm{d}\mu_1 = \mu_1(E_1)\mu_2(E_2) = \mu(E)\implies \SSS_{\text{rect}} \in \varphi\]

  We do the proof only for finite measure spaces ($\mu_1(X_1) < \infty, \mu_2(X_2) < \infty$)

  Let $E \in \varphi$, $sl_{x_1}(E^\complement)$, $\mu_2(sl_{x_1}(E^\complement)) = \mu_2(X_2 \setminus sl_{x_1}(E)) = \mu_2(X_2) - \mu_2(sl_{x_1}(E))$.

  \[\int \mu(sl_{x_1}(E^\complement)) = \int \mu(X_2) - \mu_2(sl_{x_1}(E)) \ \mathrm{d}\mu_1 = \underbrace{\mu_1(X_1)\mu_2(X_2)}_{\mu(X)} - \mu(E) = \mu(E^\complement)\]

  Suppose $E_1, E_2$ satisfy the theorem (i), does $E_1 \cup E_2$ satisfy the theorem
  Hard (implssible) to check directly theorem (i) for the union $E_1 \cup E_2$ 

  To go from finite to $\sigma$-finite, 
  \[X_1 = \biguplus_{j=1}^\infty A_{j, 1}\]
  \[X_2 = \biguplus_{k=1}^\infty A_{k, 2}\]
  then 
  \[sl_{x_1}(E) = \biguplus_{k=1}^\infty (sl_{x_1}(E)\cap A_{k, 2})\]
  By using countable additivity of $\mu_2$ we get
  \[\mu_2(sl_{x_1}(E)) = \sum_{k=1}^\infty \mu_2(sl_{x_1}(E) \cap A_{k, 2})\]
  then for each $k$ we konw that $\mu_2(sl_{x_1}(E) \cap A_{k, 2})$ is measurable in $X_1$ then applying 
  countable sum of measurable function is measurable.
  \begin{align*}
    \int \mu_2(sl_{x_1}(E))\ \mathrm{d}x_1 &= \int \sum_{k=1}^\infty \mu_2(sl_{x_1}(E) \cap A_{k, 2})\ \mathrm{d}x_1\\ 
    &= \sum_{k=1}^\infty \int \mu_2(sl_{x_1}(E) \cap A_{k, 2})\ \mathrm{d}x_1\\
    &= \sum_{k=1}^\infty \mu(E \cap A_{k, 2})\\
    &= \mu(E)
  \end{align*}
\end{proof}

\begin{theorem}
  Let $(X_i, \SM_i, \mu_i), i=1,2$ $\sigma$-finite measure spaces, $\mu = \mu_1 \times \mu_2$ be a product measure on $\SM_1 \otimes \SM_2$. 
  Let $f \in \mathcal{L}^+(X, \mu)$ then 
  \begin{itemize}
    \item $x_1 \mapsto \int f_{x_1} \ \mathrm{d}\mu_2$ belongs to $\mathcal{L}^+(X_1, \mu_1)$
    \item $x_2 \mapsto \int f^{x_2} \ \mathrm{d}\mu_1$ belongs to $\mathcal{L}^+(X_2, \mu_2)$
  \end{itemize}
  and 
  \[\int f \ \mathrm{d}\mu = \int \int f_{x_1} \ \mathrm{d}\mu_2 \mathrm{d}\mu_1\]
\end{theorem}

\begin{proof}
  We have proved this theorem for simple functions / indicator functions of measureable sets.
  Let $\{s_n\}_{n=1}^\infty$ be a sequence of simple functions such that $s_n(x) \nearrow f(x)$ for all $x$. 
  define 
  \[g_n(x_1) = \int s_n(x_1, x_2) \ \mathrm{d}\mu_2,\ h_n(x_2) = \int s_n(x_1, x_2) \ \mathrm{d}\mu_1\]
  \[g(x_1) = \int f(x_1, x_2) \ \mathrm{d}\mu_2,\ h(x_2) = \int f(x_1, x_2) \ \mathrm{d}\mu_1\]
  By Monotone Convergence Theorem, we have $g_n \nearrow g$, $h_n \nearrow h$ and limit of measureable functions is measureable.
  By the fact that $g_n \nearrow g$, 
  \[\lim_{n\to\infty}\int g_n \ \mathrm{d}\mu_1 = \int g \ \mathrm{d}\mu_1 = \int \int f(x_1, x_2) \ \mathrm{d}\mu_1 \mathrm{d}\mu_2 \]
  \[\lim_{n\to\infty}\int g_n \ \mathrm{d}\mu_1 = \lim_{n\to\infty} \int\int s_n(x_1, x_2) \ \mathrm{d}\mu_2 \mathrm{d}\mu_1 \overset{Cavalieri}= \lim_{n\to\infty} \int s_n \ \mathrm{d}\mu \overset{\text{def}}= \int f \ \mathrm{d}\mu\]
\end{proof}

\begin{theorem}
  $f \in \mathcal{L}^1(X, \mu)$ then $f_{x_1} \in \mathcal{L}^1(X_2, \mu_2)$ for $\mu_1$ almost every $x_1$ and $f^{x_2} \in \mathcal{L}^1(X_1, \mu_1)$ for $\mu_2$ almost every $x_2$
  and 
  \[\int f \ \mathrm{d}\mu = \int \int f_{x_1} \ \mathrm{d}\mu_2 \ \mathrm{d}\mu_1 = \int \int f^{x_2} \ \mathrm{d}\mu_1 \ \mathrm{d}\mu_2\]
\end{theorem}
