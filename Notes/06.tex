\chapter{Product measure}
\section{Introduction}

Given two (or finitely many) measure space $(X_1, \SM_1, \mu_1),(X_2, \SM_2, \mu_2)$
$X = X_1 \times X_2$, On $X$ there is a natural $\sigma$-algebra $\SM = \SM_1 \otimes \SM_2 =:$ $\sigma$-algebra generated by set of the form.
$E_1 \times E_2, E_1 \in \SM_1, E_2 \in \SM_2$ and 
$\mu(E_1 \times E_2) = \mu_1(E_1) \mu_2(E_2)$


Extend the set function $\mu$, defined on the general rectangles to all of $\SM_1 \otimes \SM_2$.

\begin{claim}
  The rectangles form a semiring (use cartesian product $\SM_1 \times \SM_2$ of semirings are semiring)
\end{claim}

\begin{theorem}
  Given $(X_1, \SM_1, \mu_1), (X_2, \SM_2, \mu_2)$, $\sigma$-finite measure spaces, there exists a unique measure $\mu$ on $\SM_1 \otimes \SM_2$ such that $\mu(E_1 \times E_2) = \mu_1(E_1) \mu_2(E_2)$ for all $E_1 \in \SM_1, E_2 \in \SM_2$
\end{theorem}

\begin{proof}
  $\SSS_{\text{rect}} = \SM_1 \times \SM_2$ semiring of rectangles.
  Need to show that $\nu: \SSS_{\text{rect}} \to [0, \infty)$ is a premeasure
  verify $\sigma$-additivity on $\SSS_{\text{rect}}$ If 
  $$E_1 \times E_2 = \biguplus_{j=1}^\infty E_{j, 1} \times E_{j, 2}$$then
  $$\nu(E_1 \times E_2) = \sum_{j=1}^\infty \nu(E_{j, 1} \times E_{j, 2})$$
  \[\mathbbm{1}_{E_1 \times E_2}(x_1, x_2) = \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1} \times E_{j, 2}}(x_1, x_2)\iff \mathbbm{1}_{E_1}(x_1) \mathbbm{1}_{E_2}(x_2) = \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2)\]
  \begin{align*}
    \mathbbm{1}_{E_1}(x_1) \mathbbm{1}_{E_2}(x_2) &= \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2) \\
    \int \mathbbm{1}_{E_1}(x_1) \mathbbm{1}_{E_2}(x_2)\ \mathrm{d}\mu_2 &= \int \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2) \ \mathrm{d}\mu_2\\
    \mathbbm{1}_{E_1}(x_1)\mu_2(E_2) &= \sum_{j=1}^\infty\int \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2) \ \mathrm{d}\mu_2\\
    &= \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mu_2(E_{j, 2}) \\
    \int \mathbbm{1}_{E_1}(x_1)\mu_2(E_2) \ \mathrm{d}\mu_1 &= \int \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mu_2(E_{j, 2}) \ \mathrm{d}\mu_1\\
    \mu_1(E_1)\mu_2(E_2) &= \sum_{j=1}^\infty \mu_1(E_{j, 1})\mu_2(E_{j, 2}) \\
    \nu(E_1 \times E_2) &= \sum_{j=1}^\infty \nu(E_{j, 1} \times E_{j, 2})
  \end{align*}
  % \[\mathbbm{1}_{E_1}(x_1) \mu_2(E_2) = \int \sum_{j=1}^\infty \mathbbm{1}_{E_{j, 1}}(x_1) \mathbbm{1}_{E_{j, 2}}(x_2)\ \mathrm{d}\mu_2\ = \sum_{j}\mathbbm{1}_{E_{j, 1}}(x_1)\mu_2(E_{j, 2})\]
  % By Monotone Convergence Theorem then Integrate in $x_1$
  % \[ \nu(E_1 \times E_2) = \mu_1(E_1)\mu_2(E_2) = \int\sum_j \mathbbm{1}_{E_{j, 1}}\mu_2(E_{j, 2}) \ \mathrm{d}\mu_1 = \sum_j \mu_1(E_{j, 1})\mu_2(E_{j, 2}) = \sum_j \nu(E_{j, 1}\times E_{j, 2})\]
\end{proof}

\begin{lemma}
  If $\mu_1$ is $\sigma$-finite and $\mu_2$ is $\sigma$-finite, then $\nu$ is $\sigma$-finite.
\end{lemma}
\begin{proof}
  $X_1 = \biguplus_{j=1}^\infty X_{1, j}$, $X_2 = \biguplus_{k=1}^\infty X_{2, k}$, $\mu_1(X_{1, j}) < \infty$, $\mu_2(X_{2, k}) < \infty$
  $X_1 \times X_2 = \biguplus_{j, k} X_{1, j} \times X_{2, k}$, $\nu(X_{1, j} \times X_{2, k}) = \mu_1(X_{1, j})\mu_2(X_{2, k}) < \infty$
\end{proof}

\begin{remark}
  In Summary, we have proved that the product pre-measure extends uniquely to $\SM_1 \otimes \SM_2$. (under the assumption of $\sigma$-finiteness of $\mu_1, \mu_2$)
\end{remark}

\begin{remark}
  Constructed a product measure on $\SM_1 \otimes \SM_2$ by $\mu(E_1 \times E_2) = \mu_1(E_1)\mu_2(E_2)$
  (this is unique if $\SM_1, \SM_2$ are $\sigma$-finite)
\end{remark}

\begin{lemma}
  Let $E \in \SM_1 \otimes \SM_2$, Define  
  \[sl_{x_1}(E) = \{x_2: (x_1, x_2) \in E\}\]
  \[sl^{x_2}(E) = \{x_1 : (x_1, x_2) \in E\}\]
  Then $sl_{x_1}(E) \in \SM_2$, $sl^{x_2}(E) \in \SM_1$
\end{lemma}

\begin{proof}
  Considering the rectangle case, this is ``easy''
  \[sl_{x_1}(E_1 \times E_2) = \{x_2 : (x_1, x_2) \in E_1 \times E_2\} = \begin{cases}
    \emptyset, & x_1 \notin E_1\\
    E_2, & x_1 \in E_1
  \end{cases}\]
  Define
  \[\mathfrak{C}_{x_1} = \{E \in \kP(X_1 \times X_2) : sl_{x_1}(E) \in \SM_2\}\]
  we know that $\SSS_{\text{rect}} \subseteq \mathfrak{C}_{x_1}$

  Check $\mathfrak{C}_{x_1}$ is a $\sigma$-algebra (If so, $\mathfrak{C}_{x_1}$ contains $\kM(\SSS_{\text{rect}}) = \SM_1 \otimes \SM_2$)
  \begin{enumerate}[(i)]
    \item $sl_{x_1}(X_1 \times X_2) = X_2 \in \SM_2$, so, $X_1 \times X_2 \in \mathfrak{C}_{x_1}$
    \item Let $E \in \mathfrak{C}_{x_1}$, we know that $sl_{x_1}(E) \in \SM_2$, consider $E^\complement = X \setminus E$  
  \[sl_{x_1}(E^\complement) = \{x_2 : (x_1, x_2) \not\in E\} = \{x_2 : x_2 \not\in sl_{x_1}(E)\} = (sl_{x_1}(E))^\complement \in \SM_2\]
    \item For $E_j \in \mathfrak{C}_{x_1}$, we know that $sl_{x_1}(E_j) \in \SM_2$, then
  \[sl_{x_1}\left(\bigcup_{j=1}^\infty E_j\right) = \bigcup_{j=1}^\infty sl_{x_1}\left( E_j\right) \in \SM_2\]
  \end{enumerate}
  So, $\mathfrak{C}_{x_1}$ is a $\sigma$-algebra, and $\mathfrak{C}_{x_1}$ contains $\SSS_{\text{rect}}$, so $\mathfrak{C}_{x_1}$ contains $\SM_1 \otimes \SM_2$.
  Hence, for any $E \in \SM_1 \otimes \SM_2$, $sl_{x_1}(E) \in \SM_2$.
  % and is a $\sigma$-algebra. 
\end{proof}

\begin{lemma}
  Let $f$ be a $(\SM_1 \otimes \SM_2)$-measurable. Then $f_{x_1}(x_2) = f(x_1, x_2)$ is an $\SM_2$-measurable,
  and $f^{x_2}(x_1) = f(x_1, x_2)$ is an $\SM_1$-measurable
\end{lemma}

\begin{proof}
  Check: $f^{-1}_{x_1}(I) \in \SM_2$, for any Borel set $I$
  \begin{align*}
    f^{-1}_{x_1}(I) &= \{x_2 : f_{x_1}(x_2) = f(x_1, x_2) \in I\} \\
    &= sl_{x_1}(\{(x_1, x_2) : f(x_1, x_2) \in I\}) \\
    &= sl_{x_1}(\underbrace{f^{-1}(I)}_{\in \SM_1 \otimes \SM_2})
  \end{align*}
\end{proof}

\section{Extension of Measure on Integral}

\begin{theorem}[Cavalieri's Principle]
  Let $(X_1, \SM_1, \mu_1), (X_2, \SM_2, \mu_2)$ be $\sigma$-finite and let $\mu$  be a product measure of two measure space.
  For any $E \in \SM_1 \otimes \SM_2$, then
  \begin{enumerate}[(i)]
    \item $g_E : x_1 \mapsto \mu_2(sl_{x_1}(E))$ is $\SM_1$-measurable
    \item $h_E : x_2 \mapsto \mu_1(sl^{x_2}(E))$ is $\SM_2$-measurable
  \end{enumerate}
  and 
  \begin{enumerate}[(i)]
    \item $\mu(E) = \int g_E \ \mathrm{d}\mu_1 = \int \mu_2(sl_{x_1}(E)) \ \mathrm{d}\mu_1$
    \item $\mu(E) = \int h_E \ \mathrm{d}\mu_2 = \int \mu_1(sl^{x_2}(E)) \ \mathrm{d}\mu_2$
  \end{enumerate}
\end{theorem}

\begin{proof}
  First, consider the case that $\mu_1(X_1) < \infty$ and $\mu_2(X_2) < \infty$. 
  Similarly, considering the rectangle case, for any $E \in \SSS_{\text{rect}}$, 
  \[g_E(x_1) = \begin{cases}
    \mu_2(E_2) & \text{if } x_1 \in E_1 \\
    0 & \text{if } x_1 \notin E_1
  \end{cases}\]
  So, $g_E$ is $\SM_1$-measurable.
  Moreover, 
  \[\int g_E \ \mathrm{d}\mu_1 = \int_{E_1}\mu_2(E_2) \ \mathrm{d}\mu_1 = \mu_1(E_1)\mu_2(E_2) = \mu(E)\]
  proved the theorem for the rectangle case.

  Next, define 
  \[\mathfrak{C} = \left\{E \in \kP(X) : g_E \text{ is }\SM_1\text{-measurable, } \mu(E) = \int g_E \ \mathrm{d}\mu_1\right\}\]
  I will show that $\mathfrak{C}$ is a Dynkin system.
  For the case $\SM_1$-measurable,
  \begin{enumerate}[(i)]
    \item $g_X(x_1) = \mu_2(sl_{x_1}(X)) = \mu_2(X_2)$ is a constant function, so it is $\SM_1$-measurable.
    \item For $E \in \mathfrak{C}$, $g_{E^\complement}(x_1) = \mu_2(sl_{x_1}(E^\complement)) = \mu_2(X_2 \setminus sl_{x_1}(E)) = \mu_2(X_2) - \mu_2(sl_{x_1}(E))$ is $\SM_1$-measurable.
    \item For $E_j \in \mathfrak{C}$, where $E_j$ are disjoint, 
    \[g_{\biguplus_{j=1}^\infty E_j}(x_1) = \mu_2\left(sl_{x_1}\left(\biguplus_{j=1}^\infty E_j\right)\right) = \sum_{j=1}^\infty \mu_2(sl_{x_1}(E_j))\]
     is $\SM_1$-measurable.
  \end{enumerate}
  For the case of $\mu(E) = \int g_E \ \mathrm{d}\mu_1$,
  \begin{enumerate}[(i)]
    \item $$\int g_X \ \mathrm{d}\mu_1 = \int \mu_2(sl_{x_1}(X)) \ \mathrm{d}\mu_1 = \mu_1(X_1)\mu_2(X_2)= \mu(X)$$
    \item For $E \in \mathfrak{C}$,
    \begin{align*}
      \int g_{E^\complement} \ \mathrm{d}\mu &= \int \mu_2(sl_{x_1}(E^\complement)) \ \mathrm{d}\mu = \int \mu_2(X_2) - \mu_2(sl_{x_1}(E)) \ \mathrm{d}\mu \\
      &= \mu(X) - \mu(E) = \mu(E^\complement)
    \end{align*}
    \item For $E_j \in \mathfrak{C}$, where $E_j$ are disjoint,
    \begin{align*}
      \int g_{\biguplus_{j=1}^\infty E_j} \ \mathrm{d}\mu &= \int \sum_{j=1}^\infty \mu_2(sl_{x_1}(E_j)) \ \mathrm{d}\mu = \sum_{j=1}^\infty \int \mu_2(sl_{x_1}(E_j)) \ \mathrm{d}\mu\\
      &= \sum_{j=1}^\infty \mu(E_j) = \mu\left(\biguplus_{j=1}^\infty E_j\right)
    \end{align*}
  \end{enumerate}
  We have a theorem stating that if $\SE$ is $\cap$-stable then $\mathcal{D}(\SE) = \kM(\SE)$. 
  I will show that $\mathfrak{C}$ is a Dynkin system containing $\SSS_{\text{rect}}$ and $\kM(\SSS_{\text{rect}}) \subseteq \mathfrak{C}$.
  Since the ractangle cases are $\SM_1$-measurable, $\mathfrak{C}$ contains $\SSS_{\text{rect}}$. Moreover, since $\SSS_{\text{rect}}$ is 
  semiring, so it is $\cap$-stable,
  and from the definition of Dynkin system, 
  $\kM(\SSS_{\text{rect}}) = \mathcal{D}(\SSS_{\text{rect}}) \subseteq \mathfrak{C}$. 
  Hence, for any $E \in \SM_1 \otimes \SM_2$, $g_E$ is $\SM_1$-measurable and $\mu(E) = \int g_E \ \mathrm{d}\mu_1$.


    % Using standard trick $\varphi \subseteq \kP(X_1 \times X_2)$ for which part (i) of the theorem is true
  % check $\varphi$ is a $\sigma$-algebra and it contains the $\SSS_{\text{rect}}$

  % Cor of claim: $\varphi$ contains $\kM(\SSS_{\text{rect}}) \overset{\text{def}}{=} \SM_1 \otimes \SM_2$

  % Consider $E \in \SSS_{\text{rect}}$, i.e., $E = E_1 \times E_2$, $E_1 \in \SM_1, E_2 \in \SM_2$
  % then \[sl_{x_1}(E) = \begin{cases}
  %   E_2  & \text{if } x_1 \in E_1 \\
  %   \emptyset & \text{if } x_1 \notin E_1
  % \end{cases}\]
  % \[g_E(x_1) = \mu_2(sl_{x_1}(E)) = \mathbbm{1}_{E_1}(x_1) \mu_2(E_2)\]
  % \[\int g_E \ \mathrm{d}\mu_1 = \mu_1(E_1)\mu_2(E_2) = \mu(E)\implies \SSS_{\text{rect}} \in \varphi\]

  % We do the proof only for finite measure spaces ($\mu_1(X_1) < \infty, \mu_2(X_2) < \infty$)

  % Let $E \in \varphi$, $sl_{x_1}(E^\complement)$, $\mu_2(sl_{x_1}(E^\complement)) = \mu_2(X_2 \setminus sl_{x_1}(E)) = \mu_2(X_2) - \mu_2(sl_{x_1}(E))$.

  % \[\int \mu(sl_{x_1}(E^\complement)) = \int \mu(X_2) - \mu_2(sl_{x_1}(E)) \ \mathrm{d}\mu_1 = \underbrace{\mu_1(X_1)\mu_2(X_2)}_{\mu(X)} - \mu(E) = \mu(E^\complement)\]

  % Suppose $E_1, E_2$ satisfy the theorem (i), does $E_1 \cup E_2$ satisfy the theorem
  % Hard (implssible) to check directly theorem (i) for the union $E_1 \cup E_2$ 

  % To go from finite to $\sigma$-finite, 
  % \[X_1 = \biguplus_{j=1}^\infty A_{j, 1}\]
  % \[X_2 = \biguplus_{k=1}^\infty A_{k, 2}\]
  % then 
  % \[sl_{x_1}(E) = \biguplus_{k=1}^\infty (sl_{x_1}(E)\cap A_{k, 2})\]
  % By using countable additivity of $\mu_2$ we get
  % \[\mu_2(sl_{x_1}(E)) = \sum_{k=1}^\infty \mu_2(sl_{x_1}(E) \cap A_{k, 2})\]
  % then for each $k$ we konw that $\mu_2(sl_{x_1}(E) \cap A_{k, 2})$ is measurable in $X_1$ then applying 
  % countable sum of measurable function is measurable.
  % \begin{align*}
  %   \int \mu_2(sl_{x_1}(E))\ \mathrm{d}x_1 &= \int \sum_{k=1}^\infty \mu_2(sl_{x_1}(E) \cap A_{k, 2})\ \mathrm{d}x_1\\ 
  %   &= \sum_{k=1}^\infty \int \mu_2(sl_{x_1}(E) \cap A_{k, 2})\ \mathrm{d}x_1\\
  %   &= \sum_{k=1}^\infty \mu(E \cap A_{k, 2})\\
  %   &= \mu(E)
  % \end{align*}
\end{proof}

\begin{theorem}[Tonelli's Theorem]
  Let $(X_i, \SM_i, \mu_i), i=1,2$ $\sigma$-finite measure spaces, $\mu = \mu_1 \times \mu_2$ be a product measure on $\SM_1 \otimes \SM_2$. 
  Let $f \in \mathcal{L}^+(X, \mu)$ then 
  \begin{itemize}
    \item $x_1 \mapsto \int f_{x_1} \ \mathrm{d}\mu_2$ belongs to $\mathcal{L}^+(X_1, \mu_1)$
    \item $x_2 \mapsto \int f^{x_2} \ \mathrm{d}\mu_1$ belongs to $\mathcal{L}^+(X_2, \mu_2)$
  \end{itemize}
  and 
  \[\int f \ \mathrm{d}\mu = \int \int f_{x_1} \ \mathrm{d}\mu_2 \mathrm{d}\mu_1\]
\end{theorem}

\begin{proof}
  We have proved this theorem for simple functions / indicator functions of measureable sets.
  Let $\{s_n\}_{n=1}^\infty$ be a sequence of simple functions such that $s_n(x) \nearrow f(x)$ for all $x$. 
  define 
  \[g_n(x_1) = \int s_n(x_1, x_2) \ \mathrm{d}\mu_2,\ h_n(x_2) = \int s_n(x_1, x_2) \ \mathrm{d}\mu_1\]
  \[g(x_1) = \int f(x_1, x_2) \ \mathrm{d}\mu_2,\ h(x_2) = \int f(x_1, x_2) \ \mathrm{d}\mu_1\]
  By Monotone Convergence Theorem, we have $g_n \nearrow g$, $h_n \nearrow h$ and limit of measureable functions is measureable.
  By the fact that $g_n \nearrow g$, 
  \[\lim_{n\to\infty}\int g_n \ \mathrm{d}\mu_1 = \int g \ \mathrm{d}\mu_1 = \int \int f(x_1, x_2) \ \mathrm{d}\mu_2 \mathrm{d}\mu_1 \]
  \[\lim_{n\to\infty}\int g_n \ \mathrm{d}\mu_1 = \lim_{n\to\infty} \int\int s_n(x_1, x_2) \ \mathrm{d}\mu_2 \mathrm{d}\mu_1 \overset{Cavalieri}= \lim_{n\to\infty} \int s_n \ \mathrm{d}\mu \overset{\text{def}}= \int f \ \mathrm{d}\mu\]
\end{proof}

\begin{theorem}[Fubini's Theorem]
  $f \in \mathcal{L}^1(X, \mu)$ then $f_{x_1} \in \mathcal{L}^1(X_2, \mu_2)$ for $\mu_1$ almost every $x_1$ and $f^{x_2} \in \mathcal{L}^1(X_1, \mu_1)$ for $\mu_2$ almost every $x_2$
  and 
  \[\int f \ \mathrm{d}\mu = \int \int f_{x_1} \ \mathrm{d}\mu_2 \ \mathrm{d}\mu_1 = \int \int f^{x_2} \ \mathrm{d}\mu_1 \ \mathrm{d}\mu_2\]
\end{theorem}

\section{Distribution Function}
\begin{definition}
  Given $(X, \SM, \mu)$, given measurable function $f$, define
  \[\alpha \mapsto \mu_f(\alpha) = \mu(\{x : |f| > \alpha\})\]
  $\alpha > 0$
\end{definition}

\begin{theorem}
  Given $(X, \SM, \mu)$, 
  \[\int |f|^p \ \mathrm{d}\mu = \int_0^\infty p\alpha^{p-1} \mu_f(\alpha) \ \mathrm{d}\alpha\]
\end{theorem}

\begin{example}
  example where $\mu_f$ shows
  \[\mu_f(\alpha) = \frac{\|f\|^p_p}{\alpha^p}\]
  Chebyshev's inequality

  $L^{p, \infty} =$ ``weake type p-spaces'' $\iff$ $f$ measurable $\iff$ $\sup_{\alpha} \alpha^p \mu_f(\alpha) < \infty$
\end{example}

\begin{proof}
  % careful about non-sigma finite 
  We first assume $\mu$ is $\sigma$-finite.
  Considering Right-hand-side 
  \begin{align*}
    \int_0^\infty p\alpha^{p-1} \mu_f(\alpha) \ \mathrm{d}\alpha &= \int_0^\infty p\alpha^{p-1}\int_{|f(x)| > \alpha} \ \mathrm{d}\mu \mathrm{d}\alpha\\
    &= \int_0^\infty \int_X p\alpha^{p-1} \mathbbm{1}_{\{x : |f(x)| - \alpha > 0\}} (x, \alpha) \ \mathrm{d}\mu \mathrm{d}\alpha
  \end{align*}
  $x \mapsto f(x)$ is measurable as a function on $X$, and as a function on $X\times [0, \infty)$. 
  define $g: \RR^2 \to \RR, (t, \alpha) \mapsto (|t| - \alpha)\mathbbm{1}_{\alpha > 0}$ then $g \circ f$ is $\SM$-measurable 
  because $(g \circ f)^{-1} = f^{-1} \circ g^{-1}$ then
  \begin{align*}
    \int_0^\infty p\alpha^{p-1} \mu_f(\alpha) \ \mathrm{d}\alpha &= \int_X \underbrace{\int_{\alpha=0}^{|f(x)|} p\alpha^{p-1} \ \mathrm{d}\alpha}_{|f(x)|^p}\mathrm{d}\mu  
  \end{align*}
  This proves the formula for $\sigma$-finite $X$.

  For the general cases, let assume that there exists $\alpha$ such that $\mu_f(\alpha) = \infty$,
  $\mu(\{x : |f(x) > \alpha\}) = \infty$ $\implies \mu_f(\beta) = \infty$ for $0 < \beta < \alpha$.
  In this case, we have $\infty = \infty$

  Assume $\mu_f(\alpha) < \infty$ for all $\alpha > 0$

  claim: $\{x : |f(x)| > 0\} = \bigcup_{n} \{x : |f(x) > \frac1n \}$, $\sigma$-finite because 
  $ \mu(\{x : |f(x) > \frac1n \}) = \mu_f(\frac{1}n)< \infty$
\end{proof}

\begin{example}
  \[\int_{-\infty}^\infty e^{-x^2} \ \mathrm{d}x = \sqrt\pi\]
  equivalent to
  \[\int_{0}^\infty e^{-x^2} \ \mathrm{d}x = \frac{\sqrt\pi}2\]
 

\end{example}

\begin{proof}
  Let 
  \[
    F(x, y) = \begin{cases}
      ye^{-y^2(1+x^2)} & x \ge 0, y \ge 0 \\
      0 & \text{otherwise}
    \end{cases}
  \]
  \begin{align*}
    \int F \ \mathrm{d}m(x, y) = \int_{y=0}^\infty e^{-y^2}\int_{x=0}^\infty e^{-y^2x^2}y \ \mathrm{d}x\mathrm{d}y
  \end{align*}
  By changing variable, let $w = yx, \mathrm{d}w = y \ \mathrm{d}x$ then
  \begin{align*}
    \int_{y=0}^\infty e^{-y^2}\int_{x=0}^\infty e^{-y^2x^2}y \ \mathrm{d}x\mathrm{d}y = \int_{y=0}^\infty e^{-y^2}\ \mathrm{d}y \int_{w=0}^\infty e^{-w^2} \ \mathrm{d}w
  \end{align*}
  Considering LHS
  \begin{align*}
    \int F\ \mathrm{d}m = \int_{x=0}^\infty \int_y y \frac{\sqrt{1+x^2}}{\sqrt{1+x^2}} e^{-y^2(1+x^2)} \ \mathrm{d}y\mathrm{d}x 
  \end{align*}
  let $w = y \sqrt{1+x^2}$, $\mathrm{d}w = \sqrt{1+x^2} \ \mathrm{d}y$ then
  \begin{align*}
    \int F \ \mathrm{d}m &= \int_0^\infty \frac{1}{1+x^2} \int_0^\infty \frac{2w}2 e^{-w^2} \ \mathrm{d}w \mathrm{d}x \\
    &= \frac12 \int_0^\infty \frac1{1+x^2}\ \mathrm{d}x = \frac\pi4
  \end{align*}
  Considering the first integration and the second integration, we get that
  \begin{align*}
    \left(\int_0^\infty e^{-s^2} \ \mathrm{d}s\right)^2 &= \frac\pi4 \\
    \int_0^\infty e^{-s^2} \ \mathrm{d}s &= \frac{\sqrt{\pi}}2 \\
  \end{align*}
\end{proof}

\begin{example}
  \[\int_0^\infty e^{-ax} (\sin x)^2 \frac{\mathrm{d}x}x\]
  Hint: To apply Fubini-Tonelli, 
  \[\iint_{[0, \infty]\times[0, 1]} e^{-ax} \sin(2xy) \ \mathrm{d}m(x, y)\]
  (value $1/4 \ln(1+4/a^2)$)
\end{example}

\section{Linear Change of Variable}
\begin{theorem}
  Let $f \in L^1(\RR^n)$ or ($L^+(\RR^n)$) and let $A: \RR^n \to \RR^n$ be an invertible $n \times n$ matrix. Then 
  \[|\det A| \int f(Ax) \ \mathrm{d}m(x) = \int f(x) \ \mathrm{d}m(x)\]
  Moreover, $m(AE) = |\det A| m(E)$
  for every Lebesgue measureable set $E$.
\end{theorem}
\begin{proof}
  We first assume that $f$ is Borel measurable, then $x \mapsto f(Ax)$ is Borel measurable.
  (since $x \mapsto Ax$ is continuous) We consider a number of special cases.
  In what follows write $\RR^n \ni (x_1, x')$ where $x_1 \in \RR, x' \in \RR^{n-1}$.

  \textbf{Case 1:}
  \[ A = \begin{bmatrix}
    \lambda & 0 & 0 & \dotsm & 0 \\
    0 & 1 & 0 & \dotsm & 0 \\
    \vdots & \vdots & \vdots & \ddots & \vdots \\
    0 & 0 & 0 & \dotsm & 1
  \end{bmatrix}\]
  $\lambda  \neq 0$ then $\det A = \lambda$. then 
  \begin{align*}
    |c| \int f(Ax)\ \mathrm{d}m(x) &= |c|\int_{\RR^{d-1}} \left[\int_\RR f(cx, x') \ \mathrm{d}m_1(x_1)\right]\mathrm{d}m_{d-1}(x') \\
    \int_{\RR^{d-1}} \left[\int_\RR f(cx, x') \ \mathrm{d}m_1(x_1)\right]\mathrm{d}m_{d-1}(x') &= \int f(x) \ \mathrm{d}m(x) 
  \end{align*}

  \textbf{Case 2:}
  \[A = \begin{bmatrix}
    1 & \lambda \\
    0 & 1  \\
  \end{bmatrix}\]
  Then $\det A = 1$ 
  \[1 \int f(Ax) \ \mathrm{d}m(x) = \int_{\RR^{d-1}}\left[\int_\RR f(x_1 + \lambda x_2, x')\ \mathrm{d}m_1(x_1)\right] \mathrm{d}m_{d-1}(x') \]
  \[\int_{\RR^{d-1}}\left[\int_\RR f(x_1 + \lambda x_2, x')\ \mathrm{d}m_1(x_1)\right] \mathrm{d}m_{d-1}(x') = \int f(x) \ \mathrm{d}m(x)\]

  \textbf{Case 3:} A permutes two coordinates: there exist $j \neq k$ 
  where $A(e_i) = e_i$ if $i \not\in \{j, k\}$, $A(e_j) = e_k$, $A(e_k) = e_j$.
  Then $\det A = -1$.
  \[1 \int f(Ax) \ \mathrm{d}m(x) = \int f(x) \ \mathrm{d}m(x)\]

  \textbf{General case:} In general we can write $A = E_1\dotsc E_n$ where each $E_j$ is in Case 1, 2, or 3.
  \begin{align*}
    |\det A| \int f(Ax) \ \mathrm{d}x &= |\det (E_1 \dotsm E_{n-1})||\det E_n| \int f(f\circ E_1\dotsc E_{n-1})(E_n x) \ \mathrm{d}x  \\
    &= |\det (E_1 \dotsm E_{n-1})| \int f(E_1 \dotsm E_{n-1} x) \ \mathrm{d}x \\
    &= \dotsm \int f(x)\ \mathrm{d}x
  \end{align*}
  This proves the theorem when $f$ is Borel measurable. In particular, if $E$ is Borel measurable then
  \begin{align*}
    \divideontimes m(AE) &= \int \mathbbm{1}_{AE}(x) \ \mathrm{d}m(x)  \\
    &= |\det A| \int \mathbbm{1}_{AE}(Ax) \ \mathrm{d}m(x) \\
    &= |\det A| \int \mathbbm{1}_E(x) \ \mathrm{d}m(x) \\
    &= |\det A| m(E)
  \end{align*}

  Finally consider the case when $f$ is Lebesgue measurable.
  Then there is a Borel measurable function $g$ and a Borel measurable set $E$ with $m(E) = 0$
  and $f = g$ on $\RR^d \setminus E$ (so $f = g$ almost everywhere).
  Then $f \circ A = g\circ A$ on $\RR^d \setminus A^{-1}(E)$. By $\divideontimes$ $m(A^{-1}E) = 0$
  So $f \circ A$ is Lebesbue measurable and $f\circ A = g \circ A$ almost everywhere. So
  \begin{align*}
    |\det A| \int f(Ax) \ \mathrm{d}m(x) &= |\det A| \int g(Ax) \ \mathrm{d}m(x) \\
    \int g(x) \ \mathrm{d}m(x) &= \int f(x) \ \mathrm{d}m(x)
  \end{align*}
  Also, arguing exactly as in $\divideontimes$ we have $m(AE) = |\det A| m(E)$ for every Lebesgue measurable set $E$.
\end{proof}

\begin{theorem}
  Assume $f, g : [a, b] \to \RR$ are Lebesgue integrable. 
  Define
  \[F(x) = \int_{[a, x]} f \ \mathrm{d}m\]
  \[G(x) = \int_{[a, x]} g \ \mathrm{d}m\]
  then 
  \[\int_{[a, b]} Fg \ \mathrm{d}m = F(b)G(b) - \int_{[a, b]} fG \ \mathrm{d}m\]
\end{theorem}
\begin{remark}
  if $u, v: [a, b] \to \RR$ are continuously differentiable with $u(a) = v(a) = 0$, then 
  \[u(x) =\int_{[a, x]} u' \ \mathrm{d}m\]
  \[v(x) =\int_{[a, x]} v' \ \mathrm{d}m\]
  So, the above theorem implies 
  \[\int_{[a, b]}uv' \ \mathrm{d}m = u(b)v(b) - \int_{[a, b]} u'v \ \mathrm{d}m\]
\end{remark}

\begin{proof}
  Let $T = \{(x, t) : a \le x \le b, a \le t \le x\} = \{(x, t) : a \le t \le b, t \le x \le b\}$
  Then $T$ is a Lebesgue measurable set in $\RR^2$ and $(x, t) \mapsto f(t)g(x) \mathbbm{1}_T(x, t)$ is Lebesgue measurable. 
  Also by Tonelli's Theorem, 
  \begin{align*}
    \int |f(t)g(x) \mathbbm{1}_T(x, t)| \ \mathrm{d}m_2(x, t) &= \int_{[a, b]} |g(x)|\left[\int_{[a, x]}|f(t)|\ \mathrm{d}t\right] \mathrm{d}x \\
    &\le \int_{[a, b]} |g| \ \mathrm{d}m \int_{[a, b]} |f| \ \mathrm{d}m < \infty
  \end{align*}
  So, by Fubini's Theorem,
  \begin{align*}
    \int f(t) g(x) \mathbbm{1}_T(x, t) \ \mathrm{d}m_2(x, t) &= \int_{[a, b]}g(x) \left[\int_{[a, x]} f(t) \ \mathrm{d}t\right] \mathrm{d}x \\
    &= \int_{[a, b]} gF \ \mathrm{d}m
  \end{align*}
  and 
  \begin{align*}
    \int f(t)g(x)\mathbbm{1}_T(x, t) \ \mathrm{d}m_2(x, t) &= \int_{[a, b]} f(t) \left[\int_{[t, b]} g(x) \ \mathrm{d}x\right] \mathrm{d}t \\
    &= \int_{[a, b]} f(t) \left[\int_{[a, b]} g(x) \ \mathrm{d}x - \int_{[a, t]} g(x) \ \mathrm{d}x\right]\mathrm{d}t \\
    &= \int_{[a, b]} f(t) \left[ \int_{[a, b]} g(x) \ \mathrm{d}x \right]\mathrm{d}t \\
    &- \int_{[a, b]} f(t) \left[ \int_{[a, t]} g(x) \ \mathrm{d}x \right]\mathrm{d}t \\
    &= F(b)G(a) - \int_{[a, b]} fG \ \mathrm{d}m 
  \end{align*}
  So,
  \[\int_{[a, b]} Fg \ \mathrm{d}m = F(b)G(b) - \int_{[a, b]} fG \ \mathrm{d}m\]
\end{proof}

\section{Change of Variable}
We konw $A \in GL(n, \RR)$ $A$ is $n \times n$ matrix, $A$ is invertible $\iff$ $\det A = 0$.
If $f \in \mathcal{L}^+$ or $f \in \mathcal{L}^1$ then
\[\int f(x) \ \mathrm{d}m(x) = \int f(Ax) |\det A| \ \mathrm{d}m(x)\]
\[A \Omega = \{Ax : x \in \Omega\}\]

The step is to replace linear transformation to non-linear transformation.

$\phi(x) = \phi(x_1, \dotsc, x_n)$, $\phi$, $\RR^n$-valued, $\phi = (\phi_1, \dotsc, \phi_n)$.
we know that $\phi$ is differentiable on $\Omega$. if $\frac{\partial \phi_j}{\partial x_k}$ exist and are continuous. 
\[\phi'(x) = \begin{pmatrix}
  \frac{\partial \phi_1}{\partial x_1} & \dotsm & \frac{\partial \phi_1}{\partial x_n} \\
  \vdots & \ddots & \vdots \\
  \frac{\partial \phi_n}{\partial x_1} & \dotsm & \frac{\partial \phi_n}{\partial x_n} \\
\end{pmatrix}\]
$\phi(x) = Ax, \phi'(x) = A$


\begin{definition}
  Let $\Omega_1 \subseteq \RR^n$, $\Omega_2 \subseteq \RR^n$. 
  We say that $\phi: \Omega_1 \to \Omega_2$ is a $C^1$-diffeomorphism.
  if \begin{enumerate}[(i)]
    \item $\phi$ is bijective
    \item $\phi \in C^1$ (or $\frac{\partial \phi_j}{\partial x_k}$ exist and are continuous)
    \item $\det \phi'(x) \neq 0$ (i.e., $\phi'(x)$ is invertible)
  \end{enumerate}
\end{definition}

\begin{remark}
  We say that $\phi_1$ and $\phi_2$ are diffeomorphially equivalent.
  \begin{enumerate}
    \item $\Omega_1 \sim \Omega_1$, $\phi(x) = x$, $\phi'(x) = I$
    \item $\phi: \Omega_1 \to \Omega_2$, $C^1$-diffeomorphism, $\phi^{-1}(x)$ is also a $C^1$-diffeomorphism. 
    (use the inverse function theorem which proves the differentiability of $\phi^{-1}$)
    $(\phi^{-1})'(y) = (\phi'(\phi^{-1}(y)))^{-1} = (\phi'(x))^{-1}$ where $x = \phi^{-1}(y)$
    \item  
  \end{enumerate}
\end{remark}

\begin{example}
  $\phi:\underbrace{(0, 2) \times (0, \pi/4)}_{\Omega_1} \to \Omega_2$ defined by
  $\phi(x_1, x_2) = (x_1 \sin x_2, x_1 \cos x_2)$
  $\phi(r, \theta) = (r\sin \theta, r\cos \theta)$
  \[\phi'(x) = \begin{pmatrix}
    \sin x_2 & x_1 \cos x_2 \\
    \cos x_2 & -x_1 \sin x_2
  \end{pmatrix}\]
  $\det \phi'(x) = -x_1 = -r$
\end{example}

\begin{theorem}
  Let $\Omega_1, \Omega_2$ are open sets in $\RR^n$, $\phi: \Omega_1 \to \Omega_2$ is a $C_1$-diffeomorphism.
  $f \in \mathcal{L}^1(\Omega_2)$ or $f \in \mathcal{L}^+(\Omega_2)$ then 
  \[\int_{\Omega_2} f(y) \ \mathrm{d}m(y) = \int_{\Omega_1} f(\phi(x)) |\det \phi'(x)|\ \mathrm{d}m(x)\]
\end{theorem}

\begin{remark}
  In calculus, we have substitution rule
  \[\int_{\phi(a)}^{\phi(b)} f(y)\ \mathrm{d}y = \int_a^b f(\phi(x))\phi'(x)\ \mathrm{d}x\]
\end{remark}

\begin{proof}
  It is enough to show that 
  \[\int_{\Omega_2} f(y) \ \mathrm{d}m(y) \le \int_{\Omega_1} f(\phi(x)) |\det \phi'(x)| \ \mathrm{d}m(x)\]
  Then we may apply this inequality for the diffeomorphism $\phi^{-1}: \Omega_2 \to \Omega_1$ to get the reverse inequality.
  \[\int_{\Omega_1} g(x) \ \mathrm{d}m(x) \le \int_{\Omega_2} g(\phi^{-1}(y)) |\det(\phi^{-1})'(y)| \ \mathrm{d}m(y)\]
  Apply
  \[g(x) = f(\phi(x)) |\det \phi'(x)|\]
  \[\int_{\Omega_1} g(x) \ \mathrm{d}m(x) \le \int_{\Omega_2} f(\phi(\phi^{-1}(y))) |\det \phi'(\phi^{-1}(y))| |\det(\phi^{-1})'(y)| \ \mathrm{d}m(y)\]
  we know that $\phi(\phi^{-1}(y)) = y$, $\phi^{-1}(\phi'(x)) = x$ then take the differentiable, we get
  \[(\phi^{-1})'(\phi(x)) \phi'(x) = I\]
  \[\phi'(\phi^{-1}(y)) (\phi^{-1})'(y) = I\]
\end{proof}