\chapter{From Riemann to Lebesgue}

\section{Riemann Integral}

\begin{definition}
  $P = \{a = x_0 < x_1 < \cdots < x_n = b\}$ is a partition of $[a,b]$. 
\end{definition}
\begin{definition}
  If $P, P'$ are partitions of $[a, b]$ and $P \subseteq P'$, then $P'$ is a refinement of $P$. 
\end{definition}

\begin{definition}
  Given a bounded function $f: [a, b] \to \RR$ and a partition $P = \{a = x_0 < x_1 < \cdots < x_n = b\}$
  we define
  \[ m_i(f) = \inf_{t\in[x_{i-1}, x_i]}f(t)\] 
  \[ M_i(f) = \sup_{t\in[x_{i-1}, x_i]}f(t)\] 
  define the lower sum as
  \[L(f, P) = \sum_{i=1}^{n} m_i(f)(x_i - x_{i-1})\]
  and the upper sum as
  \[U(f, P) = \sum_{i=1}^{n} M_i(f)(x_i - x_{i-1})\]
\end{definition}

\begin{lemma}\label{lem:refinement}
  Given a bounded function $f: [a, b] \to \RR$ and
  partitons $P$ of $[a, b]$. Suppose that $P'$ is a refinement of $P$ then
  \[(b-a)\inf_{t\in[a, b]}f(t)\le L(f, P) \le L(f, P') \le U(f, P') \le U(f, P) \le (b-a)\sup_{t\in[a, b]}f(t)\] 
\end{lemma}

\begin{corollary}
  Suppose that $P_1, P_2$ are partitions of $[a, b]$ then $L(f, P_1) \le U(f, P_2)$
\end{corollary}
\begin{proof}
  Let $P' = P_1 \cup P_2$ then $P'$ is a refinement of $P_1$ and $P_2$ and use Lemma~\ref{lem:refinement}
\end{proof}

\begin{lemma}
  Suppose that $f: [a, b] \to \RR$ is bounded. Then
  \[(b-a)\inf_{t\in[a, b]}f(t) \leq \sup_{P}L(f, P) \leq \inf_{P}U(f, P) \leq(b-a)\sup_{t\in[a, b]}f(t)\]
\end{lemma}

\begin{definition}
  A function $f: [a, b] \to \RR$ is Riemann integrable if
  \[\sup_{P}L(f, P) = \inf_{P}U(f, P)\]
  and the common value is called the Riemann integral of $f$ and is denoted by $\int_a^b f$
\end{definition}

\begin{lemma}
  Suppose that $f: [a, b] \to \RR$ is bounded. Then $f$ is Riemann integrable if and only if for any $\eps > 0$ there exists a partition $P$ such that
  \[U(f, P) - L(f, P) < \eps\]
\end{lemma}

\begin{proof}
  $(\Rightarrow)$ For any $\eps > 0$. Suppose that $f$ is Riemann integrable. Then there exists $P_1, P_2$ such that
  \[L(f, P_1) \ge \int_a^b f - \frac{\eps}{2}\]
  \[U(f, P_2) \le \int_a^b f + \frac{\eps}{2}\]
  let $P = P_1 \cup P_2$ then
  \[U(f, P) - L(f, P) \le \eps\]

  $(\Leftarrow)$ For any $\eps > 0$, there exists $P_\eps$ such that 
  \[U(f, P_\eps) - L(f, P_\eps) < \eps\] since $\eps$ is arbitrary, we have
  \[\sup_{P}L(f, P) = \inf_{P}U(f, P)\]
\end{proof}

\begin{theorem}
  If $f: [a, b]\to\RR$ is continuous on $[a, b]$ then $f$ is Riemann integrable.
\end{theorem}


\begin{proof}
  $f$ is continuous on a compact set, so, $f$ is uniformly continous. For any $\eps > 0$, there exists
  $\delta > 0$ such that for any $x, y \in [a, b]$ if $|x - y| < \delta$ then $|f(x) - f(y)| < \frac\eps{(b-a)}$.
  Let $N$ be such that $\frac{(b-a)}{N} < \delta$ and let $P = \{x_i := a + \frac{(b-a)i}{N}\}$ then
  \begin{align*}
    U(f, P) - L(f, P) &= \sum_{i=1}^{N} (M_i(f) - m_i(f))\frac{(b-a)}{N}\\
    &\le \sum_{i=1}^{N} \frac\eps{(b-a)}\frac{(b-a)}{N}\\
    &= \eps
  \end{align*}
\end{proof}

\begin{remark}
  Let $f(x) = \mathbbm{1}_{\QQ}(x)$ defined on the $[0, 1]$. 
  Then $U(f, P) = 1$ and $L(f, P) = 0$ for any partition $P$.
  So, $f$ is not Riemann integrable.
\end{remark}

\section{Lebesgue null sets}

\begin{definition}
  For the closed interval $I = [a, b]$, the length of $I$, denoted as $\ell(I)$ is defined as $\ell(I) = b - a$ 
\end{definition}

\begin{definition}
  A set $E$ is said to be a Lebesgue null set if for any $\eps > 0$ there exists a sequence of intervals $\{I_n\}_{n\in\NN}$ such that
  \[E \subseteq \bigcup_{n=1}^{\infty}I_n\]
  and
  \[\sum_{n=1}^{\infty}\ell(I_n) < \eps\]
\end{definition}

\begin{lemma}
  Countable unions of Lebesgue null sets are Lebesgue null sets.
\end{lemma}

\begin{proof}
  For any $\eps > 0$ and for each Lebesgue null sets $E_n$ there exists $I_{E_n, i}$ such that 
  \[E_n \subseteq \bigcup_{i=1}^{\infty}I_{E_n, i}\] and \[ \sum_{i=1}^{\infty}\ell(I_{E_n, i}) < \frac{\eps}{2^n}\]
  then
  \[ \sum_{n=1}^{\infty}\sum_{i=1}^{\infty}\ell(I_{E_n, i}) < \eps\]
\end{proof}

\begin{definition}
  A set $E\subseteq [a, b]$ has content zero if for any $\eps > 0$ there exists $I_1, I_2, \ldots, I_n$ such that
  \[E \subseteq \bigcup_{i=1}^{n}I_i\]
  and
  \[\sum_{i=1}^{n}\ell(I_i) < \eps\] 
\end{definition}

\begin{lemma}\label{lem:compact-null-lebesgue-is-content-zero}
  Suppose that $E \subseteq [a, b]$ is a compact Lebesgue null set then $E$ has content zero.
\end{lemma}

\begin{proof}
  For any $\eps > 0$ there exists a sequnce of interval 
  $\{I_n\}_{n \in \NN}$ such that $E\subseteq \bigcup I_n$ and $\sum \ell(I_n) < \frac\eps2$.
  Suppose that $I_n = [a_n, b_n]$, then let $$J_n = \left(a_n - \frac\eps{2^{n+3}}, b_n + \frac\eps{2^{n+3}}\right) \supseteq E_n$$ then
  from the compactness of $E$, there exists a finite subcover $J_{n_1}, J_{n_2}, \dotsc, J_{n_k}$ such that $E \subseteq \bigcup J_{n_i}$ 
  then we construct a finite closed interval $K_i$ by 
  $$K_i = \left[a_{n_i} - \frac\eps{2^{n_i+2}}, b_{n_i} + \frac\eps{2^{n_i+2}}\right]$$ then
  $E \subseteq \bigcup K_i$ and $\sum \ell(K_i) < \eps$
\end{proof}

\begin{corollary}
  if $a < b$ then $[a, b]$ is not a Lebesgue null set.
\end{corollary}

\begin{proof}
  By contradiction, since $[a, b]$ is compact, then $[a, b]$ has content zero, 
  but $[a, b]$ don't have content zero.
\end{proof}

\section{Oscillation and Discontinuity}

\begin{definition}
  Suppose that $X \subseteq \RR$, $f: X \to \RR$ for any $x \in X$ and $\delta > 0$, define
  \[M_{f, \delta}(x) := \sup\{f(y) : d(x, y) < \delta\}\]
  \[m_{f, \delta}(x) := \inf\{f(y) : d(x, y) < \delta\}\]
then we define 
\[\mathrm{osc}_f(x) := \lim_{\delta\to0+} M_{f, \delta}(x) - m_{f, \delta}(x)\]
\end{definition}

\begin{lemma}
  $f$ is continuous at $x$ if and only if $\mathrm{osc}_f(x) = 0$.
\end{lemma}

\begin{proof}
  $(\Rightarrow)$ Suppose that $f$ is continuous at $x$, then for any $\eps > 0$ there exists $\delta > 0$ such that
  if $d(x, y) < \delta$ then $|f(x) - f(y)| < \frac\eps2$. Then
  \[M_{f, \delta}(x) - m_{f, \delta}(x) \le \sup\{f(y) : d(x, y) < \delta\} - \inf\{f(y) : d(x, y) < \delta\} < \eps\]

  $(\Leftarrow)$ Suppose that $\mathrm{osc}_f(x) = 0$, then for any $\eps > 0$ there exists $\delta > 0$ such that
  $M_{f, \delta}(x) - m_{f, \delta}(x) < \eps$. Then for any $y \in X$ such that $d(x, y) < \delta$, we have
  $|f(x) - f(y)| < \eps$ then $f$ is continuous at $x$.
\end{proof}



Before we prove this theorem, we need to prove the following lemma.

\begin{lemma}
  $\{x \in [a, b]: \mathrm{osc}_f(x) \ge \gamma\}$ is closed.
\end{lemma}

\begin{proof}
  We need to show that $\{x : \mathrm{osc}_f(x) < \gamma\}$ is open. Fix $x$ in that set.
  Let $\eps = {\gamma - \mathrm{osc}_f(x)}$ then 
  \[\sup_{|w-x|< \delta} f(w) - \inf_{|w-x| < \delta} f(w) < \mathrm{osc}_f(x) <\gamma \]
  then for any $w \in (x - \delta, x + \delta)$ if $|w - x| < \frac\delta2$ then
  \[\mathrm{osc}(w) \leq \sup_{|y - w|<\frac\delta2} f(y) - \inf_{|y-w| < \frac\delta2} f(y) < \gamma\]
  So, $B\left(x, \frac\delta2\right) \subseteq \{x : \mathrm{osc}_f(x) < \gamma\}$
\end{proof}
we observe that 
  \begin{enumerate}[(i)]
    \item If the set of discontinuities is a Lebesque null set, then 
    $\{x : \mathrm{osc}_f(x) \ge \gamma\}$ is a set of content zero. 
    \item If $\{x : \mathrm{osc}_f(x) \ge \gamma\}$ is a Lebesgue null set, then
    the set of discontinuities is also a Lebesque null set.
  \end{enumerate}

\begin{lemma}\label{lem:bounded-int-by-osc}
  Suppose that $f$ is defined on $[c, d]$, assume that $\mathrm{osc}_f(x) < \gamma$
  then we can find a partition 
  \[U(f, P) - L(f, P) < \gamma(b-a)\]
\end{lemma}
\begin{proof}
  For every $x \in [c, d]$, there exists $\delta_x > 0$ such that
  \[\sup_{|w-x| < \delta_x} f(w) - \inf_{|w-x| < \delta_x} f(x) < \gamma\]
  construct a cover by \[B(x, \delta_x) = \{w\in[c,d] : |w-x| < \delta_x\}\]
  since $[c, d]$ is compact, there exists a finite subcover $B(p_1, \delta_{p_1}), \dotsc, B(p_n, \delta_{p_n})$
  then let $\delta_0 = \frac{\min\{\delta_{p_i}\}}{100}$ 
  then we can construct a partition $P = \{c = x_0 < x_1 < \cdots < x_n = d\}$ such that $|x_i - x_{i-1}| < \delta_0$
  then $M_i - m_i < \gamma$ and 
  \begin{align*}
    U(f, P) - L(f, P) &= \sum_{i=1}^{n}(M_i - m_i)(x_i - x_{i-1})\\
    &< \gamma\sum_{i=1}^{n}(x_i - x_{i-1})\\
    &= \gamma(d-c)
  \end{align*}
\end{proof}

\begin{theorem}
  Suppose that $f: [a, b] \to \RR$ then
  $f \in \mathcal{R}([a, b])$ if and only if $f$ is bounded and the set of discontinuity of $f$ is a Lebesgue null set.
\end{theorem}

\begin{proof}
  $(\Rightarrow)$ We want to show that for every $n \in \NN$, 
  \[\mathcal{D}_n = \left\{x : \mathrm{osc}_f(x) \ge \frac1n\right\}\]
  is a Lebesque null set. For any $\eps > 0$, since $f$ is Riemann integrable, 
  there exists a partition $P$ of $[a, b]$ such that 
  \[U(f, P) - L(f, P) = \sum_{i = 1}^n (x_i - x_{i-1})(M_i - m_i) \le \frac\eps n\]
  where $M_i = \sup_{x\in[x_{i-1}, x_i]}f(x)$ and $m_i = \inf_{x\in[x_{i-1}, x_i]}f(x)$.
  in particular
  \begin{align*}
    \sum_{[x_{i-1}, x_i]\cap \mathcal{D}_n \neq \emptyset}(x_i - x_{i-1})(M_i - m_i) &\le \frac\eps n\\
    \frac1n\sum_{[x_{i-1}, x_i]\cap \mathcal{D}_n \neq \emptyset} \ell([x_{i-1}, x_i]) &\le \frac\eps n
  \end{align*}
  So, this interval cover the set $\mathcal{D}_n$

  $(\Leftarrow)$ pick $\eps_1 \ll \eps$, consider the set $D(\eps_1) = \{x \in [a, b] : \mathrm{osc}_f(x) \ge \eps_1\}$ closed set.
  Since $D(\eps_1)$ is a Lebesgue null set from the Lemma~\ref{lem:compact-null-lebesgue-is-content-zero}
  it has content zero so we can find $I_1, \dotsc, I_n$ 
  such that 
  \[\sum_{j=1}^n \ell(I_j) < \eps_1 \text{ and } D(\eps_1) \subseteq \bigcup_{j=1}^n I_j\]
  We get a partition of $[a, b]$, $a = x_0 < x_1 < \cdots < x_N = b$ 
  there are two cases that we need to consider
  \begin{enumerate}[1)]
    \item if $[x_{i-1}, x_i] \subseteq I_j$ for some $j$ then set $P_i = [x_{i-1}, x_i]$ 
    \item if $[x_{i-1}, x_i] \cap I_j = \emptyset$ for all $j$ then 
    $\mathrm{osc(x)} < \eps_1$ for all $x \in [x_{i-1}, x_i]$.
    We want to partition further the interval $[x_{i-1}, x_i]$ by partition $P_i$.
    Using Lemma~\ref{lem:bounded-int-by-osc} we can find a partition $P_i$ of $[x_{i-1}, x_i]$ such that
    \[U(f, P_i) - L(f, P_i) < \eps_1(x_i - x_{i-1})\]
  \end{enumerate}
  We form a partition $P = P_1 \cup \cdots \cup P_N$ then
  \begin{align*}
    U(f, P) - L(f, P) &= \sum_{i=1}^{N} (U(f, P_i) - L(f, P_i))\\
    &= \sum_{i: \text{case }1} (U(f, P_i) - L(f, P_i)) + \sum_{i: \text{case }2} (U(f, P_i) - L(f, P_i))\\
    &\le 2M \sum_{i: \text{case }1} (x_i - x_{i-1}) + \eps_1\sum_{i: \text{case }2} (x_i - x_{i-1})\\
    &\le 2M\eps_1 + \eps_1(b-a) \\
    &= \eps_1(2M + b-a)
  \end{align*}
\end{proof}